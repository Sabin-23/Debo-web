<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Home - God's only Store</title>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    
    <section id="header">
        <h4>God's Only Store</h4>

        <div>
            <ul id="navbar">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="About.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li id="lg-bag"><a href="cart.html"><i class="fa-solid fa-bag-shopping"></i></a></li>
                <li><a class="active" href="signin.html">Sign-in/Register</a></li>
                <a href="#" id="close"><i class="far fa-times-circle"></i></a>
            </ul>
        </div>
        <div id="mobile">
            <a href="cart.html"><i class="fa-solid fa-bag-shopping"></i></a>
            <i id="bar" class="fas fa-outdent"></i>
        </div>
    </section>

    <section id="signin">
        <div class="auth-container">
            <h2 id="form-title">Sign In</h2>

            <!-- Loading indicator -->
            <div id="loading" style="display: none; text-align: center; margin: 10px;">
                <p>Processing...</p>
            </div>

            <!-- Error/Success messages -->
            <div id="message" style="display: none; padding: 10px; margin: 10px 0; border-radius: 5px;">
            </div>

            <!-- Sign In Form -->
            <form id="signin-form" class="active">
                <input type="email" id="signin-email" placeholder="Email" required />
                <input type="password" id="signin-password" placeholder="Password" required />
                <button type="submit">Sign In</button>
            </form>

            <!-- Register Form -->
            <form id="register-form">
                <input type="text" id="register-name" placeholder="Full Name" required />
                <input type="email" id="register-email" placeholder="Email" required />
                <input type="password" id="register-password" placeholder="Password" required />
                <input type="password" id="register-confirm-password" placeholder="Confirm Password" required />
                <button type="submit">Register</button>
            </form>

            <p class="toggle-text">
                Don't have an account? <span id="toggle">Register</span>
            </p>
        </div>
    </section>

    <section id="newsletter" class="section-p1 ">
        <div class="newstext">
            <h4>Sign Up For Newsletter</h4>
            <p>Get E-mail updates about our latest shop and <span>special offers.</span></p>

        </div>
        <div class="form">
            <input type="text" placeholder="Your email address">
            <button class="normal">Sign Up</button>
        </div>
    </section>

    <footer class="footer">
         <div class="footer-container">
        
            <div class="footer-section">
                <h3>God's Only</h3>
                <p>Your one-stop shop for fashion, beauty, and lifestyle essentials. 
                Quality products, affordable prices.</p>
            </div>

            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Shop</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Customer Service</h4>
                <ul> 
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Returns</a></li>
                    <li><a href="#">Shipping</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Follow Us</h4>
                <div class="socials">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>

        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 God's only Store. All Rights Reserved.</p>
            <p>@whatis50</p>
        </div>
    </footer>

    <script>
        // Supabase configuration with your credentials
        const SUPABASE_URL = 'https://hlskxkqwymuxcjgswqnv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhsc2t4a3F3eW11eGNqZ3N3cW52Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MzQ1ODIsImV4cCI6MjA3MzAxMDU4Mn0.NdGjbd7Y1QorTF5BIqAduItcvbh1OdP1Y2qNYf0pILw';
        
        // Check if Supabase is loaded and configured
        let supabase = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            try {
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase library not loaded. Please check your internet connection.');
                }
                
                // Initialize Supabase client
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('Supabase initialized successfully');
                
                // Initialize the app
                initializeApp();
                
            } catch (error) {
                console.error('Supabase initialization error:', error.message);
                showMessage('Configuration Error: ' + error.message, 'error');
            }
        });

        function initializeApp() {
            // DOM elements
            const signinForm = document.getElementById('signin-form');
            const registerForm = document.getElementById('register-form');
            const toggle = document.getElementById('toggle');
            const formTitle = document.getElementById('form-title');
            const toggleText = document.querySelector('.toggle-text');
            const loading = document.getElementById('loading');
            const message = document.getElementById('message');

            // Toggle between sign in and register forms
            function handleToggle() {
                if (signinForm.classList.contains('active')) {
                    // Switch to register
                    signinForm.classList.remove('active');
                    registerForm.classList.add('active');
                    formTitle.textContent = 'Register';
                    toggleText.innerHTML = 'Already have an account? <span id="toggle">Sign In</span>';
                } else {
                    // Switch to sign in
                    registerForm.classList.remove('active');
                    signinForm.classList.add('active');
                    formTitle.textContent = 'Sign In';
                    toggleText.innerHTML = 'Don\'t have an account? <span id="toggle">Register</span>';
                }
                
                // Re-attach the event listener to the new toggle span
                const newToggle = document.getElementById('toggle');
                if (newToggle) {
                    newToggle.addEventListener('click', handleToggle);
                }
                clearMessage();
            }

            // Attach initial toggle listener
            if (toggle) {
                toggle.addEventListener('click', handleToggle);
            }

            // Show loading state
            function showLoading() {
                if (loading) loading.style.display = 'block';
            }

            // Hide loading state
            function hideLoading() {
                if (loading) loading.style.display = 'none';
            }

            // Show message
            function showMessage(text, type = 'info') {
                if (!message) return;
                message.textContent = text;
                message.style.display = 'block';
                message.style.backgroundColor = type === 'error' ? '#ffebee' : 
                                              type === 'success' ? '#e8f5e8' : '#e3f2fd';
                message.style.color = type === 'error' ? '#c62828' : 
                                     type === 'success' ? '#2e7d32' : '#1565c0';
                message.style.border = `1px solid ${type === 'error' ? '#c62828' : 
                                                    type === 'success' ? '#2e7d32' : '#1565c0'}`;
            }

            // Clear message
            function clearMessage() {
                if (message) message.style.display = 'none';
            }

            // Make showMessage and clearMessage globally accessible
            window.showMessage = showMessage;
            window.clearMessage = clearMessage;

            // Validate email format
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            // Validate password strength
            function isValidPassword(password) {
                return password.length >= 6;
            }

            // Sign in function
            async function signIn(email, password) {
                try {
                    showLoading();
                    clearMessage();

                    if (!supabase) {
                        throw new Error('Authentication service not available. Please check configuration.');
                    }

                    if (!isValidEmail(email)) {
                        throw new Error('Please enter a valid email address');
                    }

                    console.log('Attempting to sign in with:', email);

                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password,
                    });

                    if (error) {
                        console.error('Sign in error:', error);
                        throw error;
                    }

                    console.log('Sign in successful:', data);
                    showMessage('Sign in successful! Redirecting...', 'success');
                    
                    // Store user info if needed and redirect
                    setTimeout(() => {
                        window.location.href = 'index.html'; // Redirect to home page
                    }, 1500);

                } catch (error) {
                    console.error('Sign in error:', error);
                    showMessage(error.message || 'Sign in failed. Please try again.', 'error');
                } finally {
                    hideLoading();
                }
            }

            // Register function
            async function register(name, email, password, confirmPassword) {
                try {
                    showLoading();
                    clearMessage();

                    if (!supabase) {
                        throw new Error('Authentication service not available. Please check configuration.');
                    }

                    // Validation
                    if (!name.trim()) {
                        throw new Error('Please enter your full name');
                    }

                    if (!isValidEmail(email)) {
                        throw new Error('Please enter a valid email address');
                    }

                    if (!isValidPassword(password)) {
                        throw new Error('Password must be at least 6 characters long');
                    }

                    if (password !== confirmPassword) {
                        throw new Error('Passwords do not match');
                    }

                    console.log('Attempting to register with:', { name, email });

                    const { data, error } = await supabase.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                full_name: name,
                            }
                        }
                    });

                    if (error) {
                        console.error('Registration error:', error);
                        throw error;
                    }

                    console.log('Registration response:', data);

                    if (data.user && !data.session) {
                        showMessage('Please check your email and click the confirmation link to complete registration.', 'success');
                    } else {
                        showMessage('Registration successful! Redirecting...', 'success');
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1500);
                    }

                } catch (error) {
                    console.error('Registration error:', error);
                    showMessage(error.message || 'Registration failed. Please try again.', 'error');
                } finally {
                    hideLoading();
                }
            }

            // Sign in form handler
            if (signinForm) {
                signinForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const email = document.getElementById('signin-email').value;
                    const password = document.getElementById('signin-password').value;
                    
                    await signIn(email, password);
                });
            }

            // Register form handler
            if (registerForm) {
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const name = document.getElementById('register-name').value;
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    const confirmPassword = document.getElementById('register-confirm-password').value;
                    
                    await register(name, email, password, confirmPassword);
                });
            }

            // Check if user is already logged in
            async function checkUser() {
                if (!supabase) return;
                
                try {
                    const { data: { session } } = await supabase.auth.getSession();
                    
                    if (session) {
                        console.log('User already logged in, redirecting...');
                        // User is already logged in, redirect to home
                        window.location.href = 'index.html';
                    }
                } catch (error) {
                    console.error('Session check error:', error);
                }
            }

            // Listen for auth state changes
            function setupAuthListener() {
                if (!supabase) return;
                
                try {
                    supabase.auth.onAuthStateChange((event, session) => {
                        console.log('Auth state change:', event, session);
                        if (event === 'SIGNED_IN') {
                            console.log('User signed in:', session.user);
                        } else if (event === 'SIGNED_OUT') {
                            console.log('User signed out');
                        }
                    });
                } catch (error) {
                    console.error('Auth listener error:', error);
                }
            }

            // Initialize auth
            setupAuthListener();
            checkUser();
        }
    </script>

    <script src="script.js"></script>
</body>

</html>

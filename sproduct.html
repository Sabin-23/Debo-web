<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - God's only Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    
    <section id="header">
        <h4>God's Only Store</h4>
        <div>
            <ul id="navbar">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="About.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li id="lg-bag"><a href="cart.html"><i class="fa-solid fa-bag-shopping"></i></a></li>
                <a href="#" id="close"><i class="far fa-times-circle"></i></a>
            </ul>
            <div id="mobile">
                <a href="cart.html"><i class="fa-solid fa-bag-shopping"></i></a>
                <i id="bar" class="fas fa-outdent"></i>
            </div>
        </div>
    </section>

    <section id="prodetails" class="section-p1">
        <div class="single-pro-image">
            <img src="" width="100%" id="MainImage" alt="">
            <div class="small-img-group">
                <div class="small-img-col">
                    <img src="" width="100%" class="small-img" alt="">
                </div>
                <div class="small-img-col">
                    <img src="" width="100%" class="small-img" alt="">
                </div>
                <div class="small-img-col">
                    <img src="" width="100%" class="small-img" alt="">
                </div>
                <div class="small-img-col">
                    <img src="" width="100%" class="small-img" alt="">
                </div>
            </div>
        </div>
        
        <div class="single-pro-details">
            <h6 id="breadcrumb">Home / Shop / </h6>
            <h4 id="product-name">Loading Product...</h4>
            <h2 id="product-price">$0.00</h2>
            <select id="size-select"> 
                <option>Select Size</option>
                <option>XS</option>
                <option>S</option>
                <option>M</option>
                <option>L</option>
                <option>XL</option>
            </select>
            <input type="number" id="quantity" value="1" min="1">
            <button class="normal" id="add-to-cart">Add To Cart</button>
            <h4>Product Details</h4>
            <span id="product-description">
                Loading product details...
            </span>
        </div>
    </section>

    <section id="related-products" class="section-p1">
        <h2>You May Also Like</h2>
        <div class="pro-container" id="related-products-container">
            <!-- Related products will be loaded here -->
        </div>
    </section>

    <footer class="footer">
        <!-- Your footer content -->
    </footer>

    <script>
        // Get current product from admin storage
        function getCurrentProduct() {
            const productId = localStorage.getItem('currentProductId');
            const KEY = "local_products_v1";
            const products = JSON.parse(localStorage.getItem(KEY)) || [];
            return products.find(p => p.id === productId);
        }

        // Load and display product details
        function loadProductDetails() {
            const product = getCurrentProduct();
            
            if (!product) {
                alert('Product not found! Redirecting to shop...');
                window.location.href = 'shop.html';
                return;
            }

            // Update page title
            document.title = `${product.name} - God's Only Store`;

            // Update product images
            const mainImage = document.getElementById('MainImage');
            const smallImages = document.getElementsByClassName('small-img');
            
            mainImage.src = product.image_data_url;
            mainImage.alt = product.name;
            
            for (let img of smallImages) {
                img.src = product.image_data_url;
                img.alt = product.name;
            }

            // Update product details
            document.getElementById('breadcrumb').textContent = `Home / Shop / ${product.brand || 'God\'s Only'} / ${product.name}`;
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-price').textContent = `$${(product.price_cents / 100).toFixed(2)}`;
            document.getElementById('product-description').textContent = product.description || 'No description available.';

            // Initialize image gallery
            initImageGallery();
        }

        // Image gallery functionality
        function initImageGallery() {
            const MainImge = document.getElementById("MainImage");
            const smallimg = document.getElementsByClassName("small-img");

            for (let i = 0; i < smallimg.length; i++) {
                smallimg[i].onclick = function(){
                    MainImge.src = smallimg[i].src;
                }
            }
        }

        // Add to cart functionality
        function initAddToCart() {
            document.getElementById('add-to-cart').addEventListener('click', function() {
                const product = getCurrentProduct();
                const size = document.getElementById('size-select').value;
                const quantity = parseInt(document.getElementById('quantity').value);

                if (size === 'Select Size') {
                    alert('Please select a size');
                    return;
                }

                if (product) {
                    addToCart(product.id, quantity);
                    alert(`Added ${quantity} x ${product.name} (${size}) to cart!`);
                }
            });
        }

        // Load related products (other products from admin storage)
        function loadRelatedProducts() {
            const currentProduct = getCurrentProduct();
            const KEY = "local_products_v1";
            const products = JSON.parse(localStorage.getItem(KEY)) || [];
            const container = document.getElementById('related-products-container');
            
            // Filter out current product and get up to 4 other products
            const relatedProducts = products
                .filter(p => p.id !== currentProduct?.id)
                .slice(0, 4);
            
            container.innerHTML = '';
            
            if (relatedProducts.length === 0) {
                container.innerHTML = '<p>No other products available.</p>';
                return;
            }
            
            relatedProducts.forEach(product => {
                const productHTML = `
                    <div class="pro" onclick="viewProduct('${product.id}')">
                        <img src="${product.image_data_url}" alt="${product.name}">
                        <div class="des">
                            <span>${product.brand || 'God\'s Only'}</span>
                            <h5>${product.name}</h5>
                            <div class="star">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <h4>$${(product.price_cents / 100).toFixed(2)}</h4>
                        </div>
                        <a href="#" onclick="addToCartFromDetails('${product.id}'); return false;">
                            <i class="fa-solid fa-cart-shopping cart" style="color: #fdadcf;"></i>
                        </a>
                    </div>
                `;
                container.innerHTML += productHTML;
            });
        }

        // Global function to view product
        function viewProduct(productId) {
            localStorage.setItem('currentProductId', productId);
            window.location.href = 'sproduct.html';
        }

        // Add to cart from product details
        function addToCartFromDetails(productId) {
            event.stopPropagation();
            const KEY = "local_products_v1";
            const products = JSON.parse(localStorage.getItem(KEY)) || [];
            const product = products.find(p => p.id === productId);
            
            if (product) {
                addToCart(productId, 1);
                alert(`Added ${product.name} to cart!`);
            }
        }

        // Add to cart function (compatible with your existing cart system)
        function addToCart(productId, quantity = 1) {
            const CART_KEY = "local_cart_v1";
            const cart = JSON.parse(localStorage.getItem(CART_KEY)) || {};
            
            cart[productId] = (cart[productId] || 0) + quantity;
            localStorage.setItem(CART_KEY, JSON.stringify(cart));
            
            updateCartBadge();
        }

        // Update cart badge
        function updateCartBadge() {
            const CART_KEY = "local_cart_v1";
            const cart = JSON.parse(localStorage.getItem(CART_KEY)) || {};
            const totalItems = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
            const badge = document.querySelector('.badge');
            
            if (badge) {
                badge.textContent = totalItems;
                badge.style.display = totalItems > 0 ? 'inline-block' : 'none';
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadProductDetails();
            initAddToCart();
            loadRelatedProducts();
            updateCartBadge();
        });
    </script>
</body>
</html>
